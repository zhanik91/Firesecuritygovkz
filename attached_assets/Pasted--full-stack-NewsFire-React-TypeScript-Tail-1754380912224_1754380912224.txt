# Роль
Ты — ведущий full‑stack‑инженер.  Текущий проект: портал NewsFire (React + TypeScript + TailwindCSS, Express + Drizzle ORM + PostgreSQL).  Задача — сделать портал production‑ready, повысить UX, производительность и безопасность.

# Этап 1 — оптимизация и производительность
1. **Lazy Loading:** замени статические импорты страниц в `App.tsx` на `React.lazy` и `Suspense`.
2. **Виртуализация:** подключи `react-window` для списков (новости, маркетплейс, поиск).  Каждая страница должна отображать только видимые элементы.
3. **Оптимизация изображений:** настрой Vite/Sharp на генерацию WebP и `srcset`, используй `loading="lazy"` для `<img>`.
4. **Кэширование:** активируй persist‑кэш в `react-query` и добавь LRU‑кэш на сервере (например, node-cache) для часто запрашиваемых эндпоинтов.
5. **Исправь запуск сервера:** измени `server.listen` — используй `{ host: process.env.HOST || '127.0.0.1' }` без `reusePort`, чтобы устранить ошибку ENOTSUP:contentReference[oaicite:4]{index=4}.

# Этап 2 — UI/UX
1. Добавь полноценную систему комментариев и рейтингов для статей и объявлений (серверные модели + фронтенд‑формы).  Предусмотри пагинацию и модерацию.
2. Реализуй «Избранное» (IndexedDB + сохранение в профиле) и облако тегов с фильтрацией.
3. Интегрируй реальный AI‑помощник: создай endpoint `/api/ai` на бэкенде, который обращается к внешнему API (например, OpenAI), и обнови компонент `AIAssistant` для работы с этим endpoint, удалив случайные ответы:contentReference[oaicite:5]{index=5}.
4. Используй Skeleton‑компоненты на всех страницах, где данные загружаются (marketplace, калькуляторы, поисковая выдача, админ‑панель).
5. Добавь микроанимации с Framer Motion (hover, focus, переходы) и приведи все интерактивные элементы к стандартам WCAG (ARIA‑атрибуты, клавиатурная навигация).
6. Реализуй мультиязычность (ru/kk/en) с использованием i18next или другого решения.

# Этап 3 — Функциональность
1. Расширь фильтры advanced search: сортировка по просмотрам, фильтр по тегам, авторам и диапазону дат.  Настрой полнотекстовый поиск в PostgreSQL.
2. Добавь экспорт материалов в PDF/Excel (react‑pdf, xlsx).
3. Интегрируй карты (Leaflet + OpenStreetMap) для отображения объектов и поставщиков.
4. Настрой отправку email‑уведомлений (Resend или SendGrid) и добавь кнопки share для VK, Telegram, WhatsApp.

# Этап 4 — Backend
1. Установи и настрой `express-rate-limit` (100 запросов/10 минут).  Вынеси конфигурацию в отдельный middleware.
2. Для каждого эндпоинта пропиши схему валидации с `zod` (req.body, req.query, req.params) и возвращай 400 с информативным сообщением при ошибке.
3. Настрой LRU‑кэш на сервере (например, node-cache) для `/api/sections`, `/api/posts/popular`, `/api/notifications` с TTL 60 сек.
4. Подключи `pino` и `pino-http` для логирования.  Добавь Prometheus метрики (HTTP duration, status codes, memory usage) и экспортируй на `/metrics`.

# Этап 5 — SEO и аналитика
1. Добавь динамические метатеги на уровне страниц (React Helmet) — title, description, og:*, twitter:*, canonical.
2. Генерируй sitemap.xml и robots.txt в postbuild (скрипт Node.js или пакет `next-sitemap`).
3. Вставь JSON‑LD Schema.org для статей (`Article`), продуктов (`Product`) и вопросов (`FAQ`).
4. Подключи Plausible или Umami для аналитики.

# Этап 6 — Админ‑панель
1. Расширь панель администратора: добавь графики (Recharts) для статистики (просмотры, активные пользователи, продажи маркетплейса).
2. Реализуй массовое редактирование контента (таблица с чекбоксами, групповые операции).  Добавь статусы (draft, pending, published) и модерацию.
3. Введи RBAC: роли admin, editor, supplier, user — и проверь доступ через middleware.
4. Создай интерфейс управления тегами, категориями, метаданными и SEO‑настройками.

# Этап 7 — Тесты и документация
1. Добавь unit‑тесты (Jest + React Testing Library) для ключевых компонентов и серверной логики.
2. Настрой Cypress/Playwright для E2E‑тестов (главная, поиск, marketplace, логин).
3. Сгенерируй Swagger/OpenAPI‑документацию (`/api/docs`) и добавь раздел с примерами запросов.
4. Создай руководство для администраторов и пользователей (Markdown) и размести в репозитории.

# Ограничения и стиль
- Используй TypeScript strict.  Соблюдай атомарный дизайн и TailwindCSS без глобальных стилей.
- Каждый пункт выполняй отдельным коммитом; дай краткий отчёт после завершения каждого этапа.
- Стремись к результату Lighthouse ≥ 90 (Performance, A11y, SEO, Best practices) и учти кросс‑браузерность.
- По завершении проекта запусти `npm run build` и приложи отчёт Lighthouse (в Markdown).

# Начни с Этапа 1.  После каждого этапа сообщи о выполнении и переходи к следующему.
